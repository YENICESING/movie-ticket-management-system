{"remainingRequest":"D:\\whisper\\cinema\\CinemaManagerUserVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\whisper\\cinema\\CinemaManagerUserVue\\src\\views\\user\\BillInfo.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\whisper\\cinema\\CinemaManagerUserVue\\src\\views\\user\\BillInfo.vue","mtime":1743402740171},{"path":"D:\\whisper\\cinema\\CinemaManagerUserVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\whisper\\cinema\\CinemaManagerUserVue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\whisper\\cinema\\CinemaManagerUserVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\whisper\\cinema\\CinemaManagerUserVue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQmlsbEluZm8iLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBxdWVyeUluZm86IHsKICAgICAgICB1c2VySWQ6ICIiLAogICAgICB9LAogICAgICBiaWxsTGlzdDogW10sCiAgICAgIHNlYXJjaFF1ZXJ5OiAiIgogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBmaWx0ZXJlZEJpbGxzKCkgewogICAgICBpZiAoIXRoaXMuc2VhcmNoUXVlcnkpIHJldHVybiB0aGlzLmJpbGxMaXN0OwogICAgICBjb25zdCBxdWVyeSA9IHRoaXMuc2VhcmNoUXVlcnkudG9Mb3dlckNhc2UoKTsKICAgICAgcmV0dXJuIHRoaXMuYmlsbExpc3QuZmlsdGVyKGJpbGwgPT4KICAgICAgICBiaWxsLmJpbGxJZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5KSB8fAogICAgICAgIGJpbGwuc3lzU2Vzc2lvbi5zeXNNb3ZpZS5tb3ZpZU5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxdWVyeSkgfHwKICAgICAgICBiaWxsLnN5c1Nlc3Npb24uc3lzSGFsbC5zeXNDaW5lbWEuY2luZW1hTmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5KQogICAgICApOwogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0VXNlcigpOwogICAgdGhpcy5nZXRCaWxsTGlzdCgpOwogIH0sCiAgbWV0aG9kczogewogICAgZ2V0VXNlcigpIHsKICAgICAgdGhpcy5xdWVyeUluZm8udXNlcklkID0gSlNPTi5wYXJzZSgKICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgibG9naW5Vc2VyIikKICAgICAgKS51c2VySWQ7CiAgICB9LAogICAgYXN5bmMgZ2V0QmlsbExpc3QoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBheGlvcy5nZXQoInN5c0JpbGwiLCB7IHBhcmFtczogdGhpcy5xdWVyeUluZm8gfSk7CiAgICAgICAgdGhpcy5iaWxsTGlzdCA9IGRhdGEuZGF0YS5tYXAoaXRlbSA9PiAoewogICAgICAgICAgLi4uaXRlbSwKICAgICAgICAgIHN5c1Nlc3Npb246IHsKICAgICAgICAgICAgLi4uaXRlbS5zeXNTZXNzaW9uLAogICAgICAgICAgICBzZXNzaW9uRGF0ZTogbW9tZW50KGl0ZW0uc3lzU2Vzc2lvbi5zZXNzaW9uRGF0ZSkuZm9ybWF0KCJZWVlZ5bm0TU3mnIhEROaXpSIpLAogICAgICAgICAgICBzeXNNb3ZpZTogewogICAgICAgICAgICAgIC4uLml0ZW0uc3lzU2Vzc2lvbi5zeXNNb3ZpZSwKICAgICAgICAgICAgICBtb3ZpZVBvc3RlcjogdGhpcy5nbG9iYWwuYmFzZSArIEpTT04ucGFyc2UoaXRlbS5zeXNTZXNzaW9uLnN5c01vdmllLm1vdmllUG9zdGVyKVswXQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIuiOt+WPluiuouWNleWIl+ihqOWksei0pToiLCBlcnJvcik7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6I635Y+W6K6i5Y2V5YiX6KGo5aSx6LSlIik7CiAgICAgIH0KICAgIH0sCiAgICBjYWxjdWxhdGVUb3RhbFByaWNlKGl0ZW0pIHsKICAgICAgcmV0dXJuIChpdGVtLnN5c1Nlc3Npb24uc2Vzc2lvblByaWNlICogSlNPTi5wYXJzZShpdGVtLnNlYXRzKS5sZW5ndGgpLnRvRml4ZWQoMik7CiAgICB9LAogICAgZm9ybWF0U2VhdHMoc2VhdHMpIHsKICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc2VhdHMpLmpvaW4oIiwgIik7CiAgICB9LAogICAgZ2V0U3RhdHVzQ2xhc3MoaXNQYWlkKSB7CiAgICAgIHJldHVybiBpc1BhaWQgPyAiY29tcGxldGVkIiA6ICJwZW5kaW5nIjsKICAgIH0sCiAgICB0b0JpbGxEZXRhaWwoaWQpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goIi9iaWxsRGV0YWlsLyIgKyBpZCk7CiAgICB9LAogICAgYXN5bmMgZGVsZXRlQmlsbChpZCkgewogICAgICB0cnkgewogICAgICAgIGF3YWl0IHRoaXMuJGNvbmZpcm0oIuehruWumuimgeWIoOmZpOatpOiuouWNleWQlz8iLCAi5o+Q56S6IiwgewogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICLnoa7lrpoiLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIuWPlua2iCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIKICAgICAgICB9KTsKCiAgICAgICAgYXdhaXQgYXhpb3MuZGVsZXRlKCJzeXNCaWxsLyIgKyBpZCk7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLorqLljZXliKDpmaTmiJDlip8iKTsKICAgICAgICB0aGlzLmdldEJpbGxMaXN0KCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgaWYgKGVycm9yICE9PSAiY2FuY2VsIikgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5Yig6Zmk6K6i5Y2V5aSx6LSlIik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaGFuZGxlU2VhcmNoKCkgewogICAgICAvLyDmkJzntKLlip/og73lt7LpgJrov4forqHnrpflsZ7mgKflrp7njrAKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["BillInfo.vue"],"names":[],"mappings":";AAuGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BillInfo.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <div class=\"bill-container\">\n    <div class=\"page-header\">\n      <div class=\"header-title\">\n        <i class=\"iconfont icon-r-shield\"></i>\n        <h1>我的订单</h1>\n      </div>\n      <div class=\"header-actions\">\n        <el-input\n          placeholder=\"搜索订单...\"\n          prefix-icon=\"el-icon-search\"\n          v-model=\"searchQuery\"\n          clearable\n          @clear=\"handleSearch\"\n          @keyup.enter.native=\"handleSearch\"\n        ></el-input>\n      </div>\n    </div>\n\n    <div class=\"order-list\">\n      <div class=\"order-card\" v-for=\"item in filteredBills\" :key=\"item.id\">\n        <div class=\"order-header\">\n          <div class=\"order-meta\">\n            <div class=\"order-date\">\n              <i class=\"el-icon-time\"></i>\n              {{ item.createTime }}\n            </div>\n            <div class=\"order-id\">\n              <i class=\"el-icon-document\"></i>\n              订单号: {{ item.billId }}\n            </div>\n          </div>\n          <div class=\"order-status\" :class=\"getStatusClass(item.payState)\">\n            {{ item.payState ? \"已完成\" : \"未完成\" }}\n          </div>\n        </div>\n\n        <div class=\"order-content\">\n          <div class=\"movie-poster\">\n            <img :src=\"item.sysSession.sysMovie.moviePoster\" alt=\"电影海报\" />\n          </div>\n          <div class=\"movie-info\">\n            <h3 class=\"movie-title\">\n              《{{ item.sysSession.sysMovie.movieName }}》\n            </h3>\n            <div class=\"cinema-info\">\n              <i class=\"el-icon-location-outline\"></i>\n              {{ item.sysSession.sysHall.sysCinema.cinemaName }}\n            </div>\n            <div class=\"hall-info\">\n              <i class=\"el-icon-video-camera\"></i>\n              {{ item.sysSession.sysHall.hallName }} ({{ item.sysSession.sysHall.hallCategory }})\n            </div>\n            <div class=\"time-info\">\n              <i class=\"el-icon-alarm-clock\"></i>\n              {{ item.sysSession.sessionDate }} {{ item.sysSession.playTime }} - {{ item.sysSession.endTime }}\n            </div>\n            <div class=\"seat-info\">\n              <i class=\"el-icon-user\"></i>\n              座位: {{ formatSeats(item.seats) }}\n            </div>\n          </div>\n          <div class=\"order-summary\">\n            <div class=\"price-info\">\n              <div class=\"total-price\">\n                ￥{{ calculateTotalPrice(item) }}\n              </div>\n              <div class=\"price-detail\">\n                ({{ JSON.parse(item.seats).length }} × ￥{{ item.sysSession.sessionPrice }})\n              </div>\n            </div>\n            <div class=\"order-actions\">\n              <el-button\n                type=\"primary\"\n                plain\n                @click=\"toBillDetail(item.billId)\"\n                class=\"detail-btn\"\n              >\n                查看详情\n              </el-button>\n              <el-button\n                type=\"danger\"\n                plain\n                @click=\"deleteBill(item.billId)\"\n                class=\"delete-btn\"\n              >\n                删除订单\n              </el-button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"empty-state\" v-if=\"filteredBills.length === 0\">\n        <i class=\"el-icon-document-delete\"></i>\n        <p>暂无订单记录</p>\n        <el-button type=\"primary\" @click=\"$router.push('/movie')\">去购票</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport moment from \"moment\";\n\nexport default {\n  name: \"BillInfo\",\n  data() {\n    return {\n      queryInfo: {\n        userId: \"\",\n      },\n      billList: [],\n      searchQuery: \"\"\n    };\n  },\n  computed: {\n    filteredBills() {\n      if (!this.searchQuery) return this.billList;\n      const query = this.searchQuery.toLowerCase();\n      return this.billList.filter(bill =>\n        bill.billId.toLowerCase().includes(query) ||\n        bill.sysSession.sysMovie.movieName.toLowerCase().includes(query) ||\n        bill.sysSession.sysHall.sysCinema.cinemaName.toLowerCase().includes(query)\n      );\n    }\n  },\n  created() {\n    this.getUser();\n    this.getBillList();\n  },\n  methods: {\n    getUser() {\n      this.queryInfo.userId = JSON.parse(\n        window.sessionStorage.getItem(\"loginUser\")\n      ).userId;\n    },\n    async getBillList() {\n      try {\n        const { data } = await axios.get(\"sysBill\", { params: this.queryInfo });\n        this.billList = data.data.map(item => ({\n          ...item,\n          sysSession: {\n            ...item.sysSession,\n            sessionDate: moment(item.sysSession.sessionDate).format(\"YYYY年MM月DD日\"),\n            sysMovie: {\n              ...item.sysSession.sysMovie,\n              moviePoster: this.global.base + JSON.parse(item.sysSession.sysMovie.moviePoster)[0]\n            }\n          }\n        }));\n      } catch (error) {\n        console.error(\"获取订单列表失败:\", error);\n        this.$message.error(\"获取订单列表失败\");\n      }\n    },\n    calculateTotalPrice(item) {\n      return (item.sysSession.sessionPrice * JSON.parse(item.seats).length).toFixed(2);\n    },\n    formatSeats(seats) {\n      return JSON.parse(seats).join(\", \");\n    },\n    getStatusClass(isPaid) {\n      return isPaid ? \"completed\" : \"pending\";\n    },\n    toBillDetail(id) {\n      this.$router.push(\"/billDetail/\" + id);\n    },\n    async deleteBill(id) {\n      try {\n        await this.$confirm(\"确定要删除此订单吗?\", \"提示\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        });\n\n        await axios.delete(\"sysBill/\" + id);\n        this.$message.success(\"订单删除成功\");\n        this.getBillList();\n      } catch (error) {\n        if (error !== \"cancel\") {\n          this.$message.error(\"删除订单失败\");\n        }\n      }\n    },\n    handleSearch() {\n      // 搜索功能已通过计算属性实现\n    }\n  }\n};\n</script>\n\n<style scoped>\n.bill-container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 30px;\n  padding-bottom: 20px;\n  border-bottom: 1px solid #eee;\n}\n\n.header-title {\n  display: flex;\n  align-items: center;\n}\n\n.header-title i {\n  font-size: 28px;\n  color: #409EFF;\n  margin-right: 15px;\n}\n\n.header-title h1 {\n  font-size: 24px;\n  color: #333;\n  margin: 0;\n}\n\n.header-actions {\n  width: 300px;\n}\n\n.order-list {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.order-card {\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n.order-card:hover {\n  transform: translateY(-3px);\n  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);\n}\n\n.order-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px 20px;\n  background-color: #f8f9fa;\n  border-bottom: 1px solid #eee;\n}\n\n.order-meta {\n  display: flex;\n  gap: 20px;\n  font-size: 14px;\n  color: #666;\n}\n\n.order-meta i {\n  margin-right: 5px;\n  color: #999;\n}\n\n.order-status {\n  padding: 5px 12px;\n  border-radius: 20px;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.order-status.completed {\n  background-color: #e6f7e6;\n  color: #67C23A;\n}\n\n.order-status.pending {\n  background-color: #fef0f0;\n  color: #F56C6C;\n}\n\n.order-content {\n  display: flex;\n  padding: 20px;\n}\n\n.movie-poster {\n  width: 100px;\n  height: 140px;\n  border-radius: 4px;\n  overflow: hidden;\n  margin-right: 20px;\n  flex-shrink: 0;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.movie-poster img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.movie-info {\n  flex: 1;\n  padding-right: 20px;\n}\n\n.movie-title {\n  font-size: 18px;\n  color: #333;\n  margin: 0 0 10px 0;\n}\n\n.cinema-info,\n.hall-info,\n.time-info,\n.seat-info {\n  font-size: 14px;\n  color: #666;\n  margin-bottom: 8px;\n  display: flex;\n  align-items: center;\n}\n\n.movie-info i {\n  margin-right: 8px;\n  color: #999;\n}\n\n.order-summary {\n  width: 200px;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  justify-content: space-between;\n}\n\n.price-info {\n  text-align: right;\n}\n\n.total-price {\n  font-size: 20px;\n  font-weight: bold;\n  color: #F56C6C;\n}\n\n.price-detail {\n  font-size: 12px;\n  color: #999;\n  margin-top: 5px;\n}\n\n.order-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.empty-state {\n  text-align: center;\n  padding: 60px 0;\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n}\n\n.empty-state i {\n  font-size: 60px;\n  color: #ddd;\n  margin-bottom: 20px;\n}\n\n.empty-state p {\n  font-size: 16px;\n  color: #999;\n  margin-bottom: 20px;\n}\n\n@media (max-width: 768px) {\n  .page-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 15px;\n  }\n\n  .header-actions {\n    width: 100%;\n  }\n\n  .order-content {\n    flex-direction: column;\n  }\n\n  .movie-info {\n    padding-right: 0;\n    margin: 15px 0;\n  }\n\n  .order-summary {\n    width: 100%;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n  }\n\n  .price-info {\n    text-align: left;\n  }\n\n  .order-actions {\n    gap: 5px;\n  }\n}\n</style>\n"]}]}